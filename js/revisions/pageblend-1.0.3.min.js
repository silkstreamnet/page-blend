!function(e,t,r){"use strict";var i=function(e){var r={},i=e.serializeArray();return t.each(i,function(){void 0!==r[this.name]?(r[this.name].push||(r[this.name]=[r[this.name]]),r[this.name].push(this.value||"")):r[this.name]=this.value||""}),r},n=function(e){return e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")},s=function(e,r){var i={},n=0;e.find("img").each(function(){var e=this,r=t(this);if(e.src){var n=e.complete&&e.naturalWidth>=0||4===e.readyState||"complete"===e.readyState;n||i[e.src]||(i[e.src]={origin:e,$origin:r,proxy:!1})}});var s=function(){n--,0==n&&(r(),i=null)};for(var o in i)i.hasOwnProperty(o)&&!i[o].proxy&&!function(e){var t=new Image;n++,i[e].proxy=t,t.onload=function(){i&&(delete i[e],s())},t.onerror=function(){i&&(delete i[e],s())},t.src=e}(o);0==n&&r()},o=!!e.history&&!!e.history.pushState,p=function(){this.properties={initiated:!1,source_name:"PageBlend",event_namespace:"PageBlend",event_listeners:{},images_cache:{},processing:!1,element:!1,target:"",url:""},this.settings={delay:600,timeout:1e4,wait_for_images:!0},r&&this.initiate()};p.prototype.process=function(r,i,p,a,c){var l=this;if(!o)return!1;r=r||"",p=p&&"POST"===p.toUpperCase()?"POST":"GET",i=!!i,a=a||{},c=c||"undefined"==typeof c?!0:!1;var u=e.location.protocol+"//"+e.location.host;if(r.match(/^http|https:\/\//)&&!r.match(new RegExp("^"+n(u)))&&!r.match(new RegExp("^"+n(u.replace(/^http:\/\//,"https://")))))return!1;l.properties.processing&&l.properties.processing.abort&&l.properties.processing.abort(),l.properties.url=r,l.properties.target=i,l.trigger("before_change",l.properties.url,l.properties.element),r=l.properties.url,i=l.properties.target;var f=!1,h=!1,v=(setTimeout(function(){h=!0,f&&f()},l.settings.delay),function(n,o){var p=!0;if(n){n=n.replace("<body","<div").replace("</body","</div");var a=t(n),u=a.filter("div:first").eq(0),f=i?t(i).eq(0):{length:0},h=i?u.find(i).eq(0):{length:0};if(f.length||h.length||(f=t(".page-blend-container").eq(0),h=u.find(".page-blend-container").eq(0)),f.length||h.length||(f=t("body").eq(0),h=u),f.length&&h.length){var v=function(){var t={target:i,source:l.properties.source_name},n=a.filter("title").eq(0).text()||document.title;document.title=n,c&&e.history.pushState(t,n,r),f.html(h.html()),l.properties.element=!1,l.properties.url="",l.trigger("after_change",o,r,h.get(0),f.get(0))};l.settings.wait_for_images?s(h,v):v()}else e.location.href=r;p=!1}p&&l.trigger("after_change",o,r,!1,!1)});return l.properties.processing=t.ajax({url:r,type:p,data:a,dataType:"html",async:!0,complete:function(e,t){h?v(e.responseText,t):f=function(){v(e.responseText,t)},l.properties.processing=!1}}),!0},p.prototype.initiate=function(){var r=this;if(!o)return r;if(!r.properties.initiated){t("html").on("click."+r.properties.event_namespace,"a",function(e){var i=t(this),n=i.attr("href"),s=!1,o="";t.each(i.add(i.parents()).toArray().reverse(),function(){var e=t(this),r=e.data("pb-disable"),i=e.data("pb-target");"undefined"!=typeof r&&""!==r&&(s=r),"undefined"!=typeof i&&""!==i&&(o=i)}),r.properties.element=this,!s&&n&&!n.match(/^(?:javascript:|#)/)&&r.process(n,o)&&e.preventDefault()}).on("submit."+r.properties.event_namespace,"form",function(e){var n=t(this),s=n.attr("action"),o=n.attr("method"),p=!1,a="";t.each(n.add(n.parents()).toArray().reverse(),function(){var e=t(this),r=e.data("pb-disable"),i=e.data("pb-target");"undefined"!=typeof r&&""!==r&&(p=r),"undefined"!=typeof i&&""!==i&&(a=i)}),r.properties.element=this,!p&&s&&r.process(s,a,o,i(n))&&e.preventDefault()}),t(e).on("popstate."+r.properties.event_namespace,function(t){t.originalEvent.state&&t.originalEvent.state.source===r.properties.source_name&&r.process(e.location.href,t.originalEvent.state.target?t.originalEvent.state.target:!1,!1,!1,!1)});var n=e.history.state;if(!n||n.source!==r.properties.source_name){var s=!1;n?"object"!=typeof n||n instanceof Array||(n.source=r.properties.source_name,s=!0):(n={source:r.properties.source_name},s=!0),s&&e.history.replaceState(n,document.title,document.location.href)}r.properties.initiated=!0}return r},p.prototype.uninitiate=function(){var r=this;return t("html").off("."+r.properties.event_namespace),t(e).off("."+r.properties.event_namespace),r.properties.initiated=!1,r},p.prototype.reinitiate=function(){var e=this;return e.uninitiate(),e.initiate(),e},p.prototype.trigger=function(e){var t=this,r=Array.prototype.slice.call(arguments,1),i=e.split(".",2),n=i[0],s=i[1]?i[1]:!1;if(t.properties.event_listeners[n])for(var o in t.properties.event_listeners[n])if(t.properties.event_listeners[n].hasOwnProperty(o)&&(s===!1||s===o))for(var p=0;p<t.properties.event_listeners[n][o].length;p++)t.properties.event_listeners[n][o][p]&&t.properties.event_listeners[n][o][p].apply(t,r);return t},p.prototype.on=function(e,t){var r=this,i=e.split(".",2),n=i[0],s=i[1]?i[1]:"_default";return r.properties.event_listeners[n]||(r.properties.event_listeners[n]={}),r.properties.event_listeners[n][s]||(r.properties.event_listeners[n][s]=[]),r.properties.event_listeners[n][s].push(t),r},p.prototype.off=function(e,t){var r=this,i=e.split(".",2),n=i[0],s=i[1]?i[1]:!1;if(r.properties.event_listeners[n])for(var o in r.properties.event_listeners[n])if(r.properties.event_listeners[n].hasOwnProperty(o)&&(s===!1||s===o))if(t)for(var p=0;p<r.properties.event_listeners[n][o].length;p++)r.properties.event_listeners[n][o][p]===t&&(r.properties.event_listeners[n][o].splice(p,1),p--);else r.properties.event_listeners[n][o]=[];return r},t.PageBlend=new p}(window,jQuery,!0);